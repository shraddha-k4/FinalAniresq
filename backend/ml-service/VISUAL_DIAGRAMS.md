# ğŸ“Š Visual Flowcharts & Diagrams

## 1. Complete System Flow

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                     ANIREQ LIVE ANIMAL DETECTION SYSTEM                   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

                              INPUT STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ“¹ CAMERA SOURCES:                                                      â”‚
â”‚  â”œâ”€ Built-in Webcam (index 0)                                           â”‚
â”‚  â”œâ”€ External USB Camera (index 1, 2, ...)                               â”‚
â”‚  â”œâ”€ IP CCTV Cameras (RTSP streams)                                      â”‚
â”‚  â””â”€ Video Files (MP4, AVI, etc.)                                        â”‚
â”‚                                                                           â”‚
â”‚  Output: 30 FPS video stream (1280x720 or native resolution)            â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                         INFERENCE STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ¤– YOLOV8 MODEL (best.pt)                                             â”‚
â”‚  â”œâ”€ Model Type: Ultralytics YOLOv8 (object detection)                  â”‚
â”‚  â”œâ”€ Input: 640x480 frames (resized from original)                      â”‚
â”‚  â”œâ”€ Processing: Every 5 frames (avoid overload)                        â”‚
â”‚  â”œâ”€ Inference Time: 50-100ms per frame                                 â”‚
â”‚  â””â”€ Output: Detections with class, confidence, bbox                    â”‚
â”‚                                                                           â”‚
â”‚  Classes Detected:                                                       â”‚
â”‚  â”œâ”€ porcupine                                                           â”‚
â”‚  â”œâ”€ redfox                                                              â”‚
â”‚  â”œâ”€ hyena                                                               â”‚
â”‚  â”œâ”€ humans â† WILL BE FILTERED OUT                                      â”‚
â”‚  â””â”€ tiger                                                               â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                         FILTERING STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  âœ‚ï¸ CLASS FILTERING:                                                    â”‚
â”‚                                                                           â”‚
â”‚  Input: All detections                                                   â”‚
â”‚  [porcupine(0.85), human(0.92), tiger(0.87), human(0.78)]              â”‚
â”‚                                                                           â”‚
â”‚  Filter Logic:                                                           â”‚
â”‚  â”œâ”€ IF class_name.lower() == 'human' â†’ DROP                            â”‚
â”‚  â”œâ”€ IF class_name.lower() == 'humans' â†’ DROP                           â”‚
â”‚  â””â”€ ELSE â†’ KEEP                                                         â”‚
â”‚                                                                           â”‚
â”‚  Output: Animals only                                                    â”‚
â”‚  [porcupine(0.85), tiger(0.87)]                                         â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                         ALERT STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ”” TERMINAL ALERT:                                                     â”‚
â”‚                                                                           â”‚
â”‚  For each animal detection:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2026-02-26 14:35:30 - [WARNING]                                   â”‚ â”‚
â”‚  â”‚ ğŸš¨ ALERT: tiger - Confidence: 0.87                                â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚ 2026-02-26 14:35:32 - [WARNING]                                  â”‚ â”‚
â”‚  â”‚ ğŸš¨ ALERT: porcupine - Confidence: 0.85                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                           â”‚
â”‚  Alert Filtering:                                                        â”‚
â”‚  â”œâ”€ Check cooldown (10 seconds per animal class)                        â”‚
â”‚  â”œâ”€ IF time since last [animal] > 10s â†’ SEND ALERT                     â”‚
â”‚  â”œâ”€ IF time since last [animal] < 10s â†’ SKIP (prevent spam)            â”‚
â”‚  â””â”€ Always print to terminal (regardless)                               â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                        FRAME BUFFER STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ“  CONTINUOUS BUFFERING (All frames):                                  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€ Frame 1 â”€â”                                                          â”‚
â”‚  â”‚ Porcupine:â”‚ (recent)                                                 â”‚
â”‚  â”‚ 0.85      â”‚                                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚        â†“                                                                 â”‚
â”‚  â”Œâ”€ Frame 2 â”€â”                                                          â”‚
â”‚  â”‚ Porcupine â”‚                                                          â”‚
â”‚  â”‚ 0.85      â”‚                                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚        â†“                                                                 â”‚
â”‚     ... (30 frames total) ...                                           â”‚
â”‚        â†“                                                                 â”‚
â”‚  â”Œâ”€ Frame 30 â”                                                          â”‚
â”‚  â”‚ Tiger:    â”‚ (oldest, about to be pushed out)                        â”‚
â”‚  â”‚ 0.87      â”‚                                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                           â”‚
â”‚  Total: 3 seconds of video (30 frames @ 10 FPS playback)               â”‚
â”‚  Storage: In-memory deque in RAM                                        â”‚
â”‚  Size: ~50-100 MB for 640x480 frames                                    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                        VIDEO CREATION STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ“¹ CREATE MP4 VIDEO CLIP (On alert pass cooldown):                    â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Input: Frame buffer (30 frames)                                 â”‚    â”‚
â”‚  â”‚ Dimensions: 640x480 pixels                                      â”‚    â”‚
â”‚  â”‚ Codec: mp4v (H.264)                                             â”‚    â”‚
â”‚  â”‚ Output FPS: 10 frames per second                                â”‚    â”‚
â”‚  â”‚ Duration: 3 seconds total                                       â”‚    â”‚
â”‚  â”‚ File Size: 500 KB - 2 MB (compressed)                           â”‚    â”‚
â”‚  â”‚ Location: System temp directory                                 â”‚    â”‚
â”‚  â”‚          (C:\Temp on Windows, /tmp on Linux)                   â”‚    â”‚
â”‚  â”‚ Result: /tmp/detection_cctv_001_1708953331.mp4                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                           â”‚
â”‚  Status messages:                                                        â”‚
â”‚  âœ… Clip created: /tmp/detection_cctv_001_1708953331.mp4 (30 frames)   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                        BACKEND UPLOAD STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ“¤ MULTIPART POST to Backend API:                                      â”‚
â”‚                                                                           â”‚
â”‚  POST http://localhost:3000/api/detections                              â”‚
â”‚  Content-Type: multipart/form-data                                      â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€ Form Fields: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚ cctv_id: "cctv_001"                                              â”‚  â”‚
â”‚  â”‚ timestamp: "2026-02-26T14:35:30.000Z"                            â”‚  â”‚
â”‚  â”‚ detections: "[{                                                  â”‚  â”‚
â”‚  â”‚              \"className\": \"tiger\",                           â”‚  â”‚
â”‚  â”‚              \"confidence\": 0.87,                               â”‚  â”‚
â”‚  â”‚              \"bbox\": {...}                                     â”‚  â”‚
â”‚  â”‚            }]"                                                   â”‚  â”‚
â”‚  â”‚ total_detections: "1"                                            â”‚  â”‚
â”‚  â”‚ frame_shape: "[480, 640]"                                        â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â””â”€ Binary File: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚ video: [binary MP4 data - 500KB to 2MB]                          â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                           â”‚
â”‚  Status: ğŸŒ In transit...                                               â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                      BACKEND PROCESSING STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ”Œ BACKEND API (/api/detections):                                      â”‚
â”‚                                                                           â”‚
â”‚  1. Parse Multipart Request                                             â”‚
â”‚     â”œâ”€ Extract form fields                                              â”‚
â”‚     â”œâ”€ Extract binary video file                                        â”‚
â”‚     â””â”€ Parse JSON fields                                                â”‚
â”‚                                                                           â”‚
â”‚  2. Validate CCTV Camera                                                â”‚
â”‚     â”œâ”€ Query: CCTVCamera.findById(cctv_id)                              â”‚
â”‚     â”œâ”€ If not found â†’ Error 404                                         â”‚
â”‚     â””â”€ If found â†’ Continue                                              â”‚
â”‚                                                                           â”‚
â”‚  3. Upload Video to Cloudinary                                          â”‚
â”‚     â”œâ”€ Use: cloudinary.uploader.upload()                                â”‚
â”‚     â”œâ”€ Resource Type: 'video'                                           â”‚
â”‚     â”œâ”€ Folder: 'detections'                                             â”‚
â”‚     â”œâ”€ Processing: Cloudinary auto-optimizes                            â”‚
â”‚     â””â”€ Return: secure_url (HTTPS CDN link)                              â”‚
â”‚        Example: https://res.cloudinary.com/YOUR_CLOUD/video/           â”‚
â”‚                 upload/v1708953332/detections/xyz123.mp4               â”‚
â”‚                                                                           â”‚
â”‚  4. Save Detection to MongoDB                                           â”‚
â”‚     â”œâ”€ Document: {                                                      â”‚
â”‚     â”‚   cctvId: ObjectId("..."),                                        â”‚
â”‚     â”‚   detectionTimestamp: ISODate("..."),                             â”‚
â”‚     â”‚   objects: [{                                                     â”‚
â”‚     â”‚     className: "tiger",                                           â”‚
â”‚     â”‚     confidence: 0.87,                                             â”‚
â”‚     â”‚     bbox: {...}                                                   â”‚
â”‚     â”‚   }],                                                             â”‚
â”‚     â”‚   totalDetections: 1,                                             â”‚
â”‚     â”‚   severity: "high",                                               â”‚
â”‚     â”‚   videoUrl: "https://res.cloudinary.com/...mp4" â† NEW!           â”‚
â”‚     â”‚   alertSent: true,                                                â”‚
â”‚     â”‚   processed: false,                                               â”‚
â”‚     â”‚   createdAt: ISODate("..."),                                      â”‚
â”‚     â”‚   updatedAt: ISODate("...")                                       â”‚
â”‚     â”‚ }                                                                  â”‚
â”‚     â”œâ”€ Collection: 'detections'                                         â”‚
â”‚     â””â”€ Indexes: (cctvId, timestamp)                                     â”‚
â”‚                                                                           â”‚
â”‚  5. Return HTTP 201 Created                                             â”‚
â”‚     â””â”€ Response: {                                                      â”‚
â”‚          success: true,                                                 â”‚
â”‚          message: "Detection recorded successfully",                    â”‚
â”‚          detection: {...full document...}                               â”‚
â”‚        }                                                                 â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                          STORAGE STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     CLOUDINARY (Video)       â”‚     MONGODB ATLAS (Metadata)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚                                          â”‚
â”‚ File: detection.mp4          â”‚ Collection: detections                   â”‚
â”‚ Size: 500KB-2MB              â”‚ Database: AniResQ                        â”‚
â”‚ Codec: H.264 (MP4)           â”‚ Document: Detection                      â”‚
â”‚ Resolution: 640x480          â”‚                                          â”‚
â”‚ Duration: 3 seconds          â”‚ Fields:                                  â”‚
â”‚ FPS: 10                       â”‚ â”œâ”€ _id: ObjectId                         â”‚
â”‚                              â”‚ â”œâ”€ cctvId: ObjectId (ref)                â”‚
â”‚ CDN: Global edge servers     â”‚ â”œâ”€ detectionTimestamp: Date              â”‚
â”‚ URL: Secure HTTPS            â”‚ â”œâ”€ objects: Array[Detection]             â”‚
â”‚ Access: Public (viewable)    â”‚ â”œâ”€ totalDetections: Integer              â”‚
â”‚ Retention: Forever           â”‚ â”œâ”€ severity: "low" | "med" | "high"     â”‚
â”‚ Bandwidth: Fast              â”‚ â”œâ”€ videoUrl: String (Cloudinary link)   â”‚
â”‚                              â”‚ â”œâ”€ alertSent: Boolean                    â”‚
â”‚ Query: Via link in MongoDB   â”‚ â”œâ”€ processed: Boolean                    â”‚
â”‚                              â”‚ â”œâ”€ createdAt: Date                       â”‚
â”‚                              â”‚ â””â”€ updatedAt: Date                       â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â”‚ Indexes:                                 â”‚
â”‚                              â”‚ â”œâ”€ (cctvId, detectionTimestamp)         â”‚
â”‚                              â”‚ â””â”€ (alertSent, severity)                â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â”‚ Retention: Forever                       â”‚
â”‚                              â”‚ Queries: Fast via indexes                â”‚
â”‚                              â”‚ Backup: Auto (Atlas backups)             â”‚
â”‚                              â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                       RESPONSE TO ML SERVICE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  âœ… HTTP 201 CREATED                                                    â”‚
â”‚                                                                           â”‚
â”‚  Response: {                                                             â”‚
â”‚    "success": true,                                                      â”‚
â”‚    "message": "Detection recorded successfully",                         â”‚
â”‚    "detection": {                                                        â”‚
â”‚      "_id": "507f1f77bcf86cd799439011",                                 â”‚
â”‚      "cctvId": "507f1f77bcf86cd799439001",                              â”‚
â”‚      "videoUrl": "https://res.cloudinary.com/...mp4",                   â”‚
â”‚      ...full document...                                                â”‚
â”‚    }                                                                      â”‚
â”‚  }                                                                        â”‚
â”‚                                                                           â”‚
â”‚  ML Service logs:                                                        â”‚
â”‚  âœ… Alert sent to backend (status: 201)                                 â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                         CLEANUP STAGE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ—‘ï¸ TEMPORARY FILE CLEANUP:                                             â”‚
â”‚                                                                           â”‚
â”‚  Delete: /tmp/detection_cctv_001_1708953331.mp4                         â”‚
â”‚  Reason: Already uploaded to Cloudinary                                  â”‚
â”‚  Result: Free up ~1-2 MB of temp storage                                â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†“
                         READY FOR NEXT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  ğŸ”„ LOOP BACK TO INFERENCE STAGE                                        â”‚
â”‚                                                                           â”‚
â”‚  Frame buffer clears oldest frames                                       â”‚
â”‚  Continue processing next frames                                         â”‚
â”‚  Ready for next animal detection                                         â”‚
â”‚                                                                           â”‚
â”‚  Metrics:                                                                â”‚
â”‚  â”œâ”€ Total time: ~1.5 seconds (camera â†’ MongoDB)                        â”‚
â”‚  â”œâ”€ Server operations: 3 (upload, insert, return)                      â”‚
â”‚  â””â”€ Data persisted: Video + Metadata                                    â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Alert Decision Tree

```
                         ğŸ“¹ FRAME CAPTURED
                                â”‚
                                â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Every 5 frames?   â”‚
                    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        Y â”‚ N (skip)
                          â”‚ â†“ (continue buffer)
                          â†“
                  ğŸ¤– RUN YOLO INFERENCE
                          â”‚
                          â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Check detections returned           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ HasDetections? â”‚
        â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       NO â”‚                               YES â”‚
          â†“                                  â†“
       (Skip)                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     â”‚ Filter out humans:   â”‚
          â”‚                     â”‚ humans â†’ DROP        â”‚
          â”‚                     â”‚ animals â†’ KEEP       â”‚
          â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                              â”‚
          â”‚                              â†“
          â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚ AnimalDetections?   â”‚
          â”‚                   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
          â”‚                     NOâ”‚               â”‚YES
          â”‚                       â”‚               â”‚
          â”‚                       â†“               â†“
          â”‚                     (Skip)    ğŸ”” Print to Terminal
          â”‚                       â”‚        "ALERT: [animal] - Conf: [X.XX]"
          â”‚                       â”‚               â”‚
          â”‚                       â”‚               â†“
          â”‚                       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚     â”‚ Cooldown check:     â”‚
          â”‚                       â”‚     â”‚ time_since_last>10s?â”‚
          â”‚                       â”‚     â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
          â”‚                       â”‚       NOâ”‚              â”‚YES
          â”‚                       â”‚        â”‚              â”‚
          â”‚                       â”‚        â†“              â†“
          â”‚                       â”‚     (Skip)    â˜‘ï¸ Should Alert: YES
          â”‚                       â”‚        â”‚              â”‚
          â”‚                       â”‚        â”‚              â†“
          â”‚                       â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚        â”‚  â”‚ Create video clip:  â”‚
          â”‚                       â”‚        â”‚  â”‚ - Get buffer (30fr) â”‚
          â”‚                       â”‚        â”‚  â”‚ - Encode MP4        â”‚
          â”‚                       â”‚        â”‚  â”‚ - Save to temp dir  â”‚
          â”‚                       â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚        â”‚             â”‚
          â”‚                       â”‚        â”‚             â†“
          â”‚                       â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚        â”‚  â”‚ POST to backend:    â”‚
          â”‚                       â”‚        â”‚  â”‚ /api/detections     â”‚
          â”‚                       â”‚        â”‚  â”‚ multipart form      â”‚
          â”‚                       â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚        â”‚             â”‚
          â”‚                       â”‚        â”‚             â†“
          â”‚                       â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚        â”‚  â”‚ Wait for response:  â”‚
          â”‚                       â”‚        â”‚  â”‚ HTTP 201?           â”‚
          â”‚                       â”‚        â”‚  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚        â”‚    YES       NO
          â”‚                       â”‚        â”‚     â”‚        â”‚
          â”‚                       â”‚        â”‚     â†“        â†“
          â”‚                       â”‚        â”‚  âœ… OK    âš ï¸ Error log
          â”‚                       â”‚        â”‚     â”‚        â”‚
          â”‚                       â”‚        â”‚     â†“        â†“
          â”‚                       â”‚        â”‚  Delete temp file
          â”‚                       â”‚        â”‚  (cleanup)
          â”‚                       â”‚        â”‚     â”‚        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â†“
                            ğŸ”„ NEXT FRAME
```

---

## 3. State Machine

```
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚   STARTUP   â”‚
                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
            â”ƒ  INITIALIZING â”ƒ
            â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
            â”ƒ Load model    â”ƒ
            â”ƒ Open camera   â”ƒ
            â”ƒ Init buffer   â”ƒ
            â”—â”â”â”â”â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”›
                 â”‚
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Model Ready?  â”‚
        â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         NOâ”‚        â”‚YES
           â”‚        â”‚
           â†“        â†“
        ERROR    MONITORING
           â”‚        â•‘
           â”‚        â•‘
           â†“        â”£â”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”“
          STOP      â•‘                                       â•‘
                    â•‘ (Continuously loop)                   â•‘
                    â•‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â•‘
                    â•‚ â”‚ Capture frame?       â”‚              â•‘
                    â•‚ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â•‘
                    â•‚   NOâ”‚             â”‚YES                â•‘
                    â•‚    â”‚              â”œâ”€â”€â”€â”€â”€â”€â”            â•‘
                    â•‚    â”‚              â†“      â”‚            â•‘
                    â•‚    â”‚         Buffer frameâ”‚            â•‘
                    â•‚    â”‚              â”‚      â”‚            â•‘
                    â•‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”   â”‚            â•‘
                    â•‚    â”‚    â”‚ Every 5fr? â”‚   â”‚            â•‘
                    â•‚    â”‚    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜   â”‚            â•‘
                    â•‚    â”‚     NOâ”‚ YES   â”‚     â”‚            â•‘
                    â•‚    â”‚      â”‚  â”‚     â”‚     â”‚            â•‘
                    â•‚    â”‚      â”‚  â†“     â”‚     â”‚            â•‘
                    â•‚    â”‚      â”‚ Infer  â”‚     â”‚            â•‘
                    â•‚    â”‚      â”‚  â”‚     â”‚     â”‚            â•‘
                    â•‚    â”‚      â””â”€â”€â”¼â”€â”€â”€â”€â”€â”˜     â”‚            â•‘
                    â•‚    â”‚         â”‚           â”‚            â•‘
                    â•‚    â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”‚            â•‘
                    â•‚    â”‚    â”‚ Animals? â”‚     â”‚            â•‘
                    â•‚    â”‚    â””â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”˜     â”‚            â•‘
                    â•‚    â”‚    YES    NO       â”‚            â•‘
                    â•‚    â”‚     â”‚      â””â”€â”€â”    â”‚            â•‘
                    â•‚    â”‚     â†“         â”‚    â”‚            â•‘
                    â•‚    â”‚  ALERTING    â”‚    â”‚            â•‘
                    â•‚    â”‚     â”‚         â”‚    â”‚            â•‘
                    â•‚    â”‚  â”Œâ”€â”€â”´â”€â”€â”      â”‚    â”‚            â•‘
                    â•‚    â”‚  â”‚Cool â”‚      â”‚    â”‚            â•‘
                    â•‚    â”‚  â”‚down?â”‚      â”‚    â”‚            â•‘
                    â•‚    â”‚  â””â”¬â”€â”€â”¬â”€â”˜      â”‚    â”‚            â•‘
                    â•‚    â”‚   NO YES      â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚  â”‚       â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚  â†“       â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚ SENDING  â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚  â”‚       â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚ â”Œâ”´â”€â”€â”€â”   â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚ â”‚HTTPâ”‚   â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚ â”‚201?â”‚   â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚ â””â”¬â”€â”¬â”€â”˜   â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚  Y N    â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚  â”‚ â”‚    â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚  â†“ â†“    â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚ LOGGED  â”‚    â”‚            â•‘
                    â•‚    â”‚    â”‚  â”‚      â”‚    â”‚            â•‘
                    â•‚    â””â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜            â•‘
                    â•‘                                       â•‘
                    â•‘ [Continue capturing frames]          â•‘
                    â•‘                                       â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 4. File Transfer Diagram

```
ML SERVICE (Python)                BACKEND (Node.js)              STORAGE
                                                                    â”‚
                                                                    â”‚
Frame Buffer â”€â”€â–º Encode MP4 â”€â”€â”                                   â”‚
(30 frames)    (3 seconds)    â”‚                                   â”‚
                              â”‚                                   â”‚
                              â”œâ”€ Video file â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                              â”‚                                   â”‚
                              â”œâ”€ Form field: cctv_id â”€â”€â”€â”€â”        â”‚ Cloudinary
                              â”‚                          â”‚        â”‚ â”œâ”€ Upload
                              â”œâ”€ Form field: timestamp â”€â”€â”¤ POST   â”‚ â”œâ”€ Store
                              â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â””â”€ Return URL
                              â”œâ”€ Form field: detections â”€â”‚        â”‚
                              â”‚                          â”‚        â”‚
                              â”œâ”€ Form field: frame_shape â”‚        â”‚
                              â”‚                          â”‚        â”‚ MongoDB
                              (multipart/form-data)      â”‚        â”‚ â”œâ”€ Insert doc
                              â”‚                          â”‚        â”‚ â”œâ”€ Store videoUrl
                              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HTTP 201 â”€â”€â”€â”€â”€â”¤        â”‚ â””â”€ Confirm
                              â”‚         (with metadata)  â”‚        â”‚
                              â”‚                          â”‚        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                                                                    â”‚
Response logged:                                                    â”‚
"âœ… Alert sent to backend                                         â”‚
 (status: 201)"                                                   â”‚
                                                                    â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Database View:                  â”‚
                              â”‚  {                               â”‚
                              â”‚    _id: ObjectId,                â”‚
                              â”‚    cctvId: ObjectId,             â”‚
                              â”‚    detections: [{...}],          â”‚
                              â”‚    videoUrl: "https://...mp4" â† NEW
                              â”‚  }                               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of Visual Diagrams**

All diagrams show the complete flow from camera input to database storage.
